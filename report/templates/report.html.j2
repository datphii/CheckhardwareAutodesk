<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8">
  <title>{{ product | upper }} {{ version }} - Hardware Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="color-scheme" content="light dark">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            pass: '#10b981',
            warn: '#f59e0b',
            fail: '#ef4444'
          }
        }
      }
    }
  </script>
  <style>
    /* Soft Minimalist / Neumorphism Styles */
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .neumorphism-card {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 
        8px 8px 16px rgba(163, 177, 198, 0.3),
        -8px -8px 16px rgba(255, 255, 255, 0.8);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .neumorphism-card:hover {
      box-shadow: 
        12px 12px 24px rgba(163, 177, 198, 0.35),
        -12px -12px 24px rgba(255, 255, 255, 0.9);
      transform: translateY(-2px);
    }
    
    .neumorphism-inset {
      background: #f5f7fa;
      border-radius: 16px;
      box-shadow: 
        inset 4px 4px 8px rgba(163, 177, 198, 0.2),
        inset -4px -4px 8px rgba(255, 255, 255, 0.8);
    }
    
    .soft-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      box-shadow: 
        4px 4px 8px rgba(102, 126, 234, 0.3),
        -2px -2px 4px rgba(255, 255, 255, 0.5);
      transition: all 0.2s ease;
    }
    
    .soft-button:hover {
      box-shadow: 
        6px 6px 12px rgba(102, 126, 234, 0.4),
        -3px -3px 6px rgba(255, 255, 255, 0.6);
      transform: translateY(-1px);
    }
    
    .soft-button:active {
      box-shadow: 
        inset 2px 2px 4px rgba(102, 126, 234, 0.3),
        inset -1px -1px 2px rgba(255, 255, 255, 0.5);
      transform: translateY(0);
    }
    
    .status-badge {
      border-radius: 12px;
      padding: 6px 16px;
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.5px;
      transition: all 0.2s ease;
    }
    
    .status-PASS {
      background: #e0f4e0;
      color: #3cb371;
      box-shadow: 0 2px 4px rgba(60, 179, 113, 0.2);
    }
    
    .status-WARN {
      background: #fff4e0;
      color: #d97706;
      box-shadow: 0 2px 4px rgba(217, 119, 6, 0.2);
    }
    
    .status-FAIL {
      background: #fbe8e8;
      color: #f44336;
      box-shadow: 0 2px 4px rgba(244, 67, 54, 0.2);
    }
    
    .status-ready {
      background: #e0f4e0;
      color: #3cb371;
    }
    
    .status-not-ready {
      background: #fbe8e8;
      color: #f44336;
    }
    
    .status-needs-upgrade {
      background: #fff4e0;
      color: #d97706;
    }
    
    /* Hardware Check Card */
    .check-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
    }
    
    .check-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }
    
    .check-card.pass {
      border-left: 4px solid #3cb371;
      background: #f0fdf4;
    }
    
    .check-card.warn {
      border-left: 4px solid #f59e0b;
      background: #fffbeb;
    }
    
    .check-card.fail {
      border-left: 4px solid #f44336;
      background: #fef2f2;
    }
    
    @media (prefers-color-scheme: dark) {
      .check-card {
        background: #1e293b;
        border-color: rgba(255, 255, 255, 0.1);
      }
      
      .check-card.pass {
        background: rgba(16, 185, 129, 0.1);
      }
      
      .check-card.warn {
        background: rgba(245, 158, 11, 0.1);
      }
      
      .check-card.fail {
        background: rgba(239, 68, 68, 0.1);
      }
    }
    
    .table-row {
      transition: all 0.2s ease;
      border-radius: 12px;
      margin: 4px 0;
    }
    
    .table-row:hover {
      background: rgba(102, 126, 234, 0.08);
      transform: translateX(4px);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }
    
    .table-header {
      background: rgba(245, 247, 250, 0.8);
    }
    
    /* Responsive Table Container */
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(102, 126, 234, 0.3) rgba(245, 247, 250, 0.5);
      margin: 0 -1rem;
      padding: 0 1rem;
    }
    
    .table-container::-webkit-scrollbar {
      height: 8px;
    }
    
    .table-container::-webkit-scrollbar-track {
      background: rgba(245, 247, 250, 0.5);
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 4px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
    
    /* Responsive Table */
    .responsive-table {
      min-width: 100%;
      width: 100%;
      border-collapse: collapse;
    }
    
    @media (min-width: 1536px) {
      .responsive-table {
        min-width: 100%;
      }
    }
    
    @media (max-width: 1535px) {
      .responsive-table {
        min-width: 1000px;
      }
    }
    
    @media (max-width: 1280px) {
      .responsive-table {
        min-width: 900px;
      }
    }
    
    @media (max-width: 1024px) {
      .responsive-table {
        min-width: 800px;
      }
    }
    
    @media (max-width: 768px) {
      .responsive-table {
        min-width: 700px;
        font-size: 0.875rem;
      }
      
      .responsive-table th,
      .responsive-table td {
        padding: 0.75rem 0.5rem;
      }
    }
    
    /* Hide less important columns on smaller screens */
    @media (max-width: 1280px) {
      .col-unit,
      .col-priority {
        display: none;
      }
    }
    
    /* Compact scrollbar for Analysis section */
    .analysis-scroll::-webkit-scrollbar {
      width: 6px;
    }
    
    .analysis-scroll::-webkit-scrollbar-track {
      background: rgba(245, 247, 250, 0.5);
      border-radius: 3px;
    }
    
    .analysis-scroll::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 3px;
    }
    
    .analysis-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
    
    /* Environment Grid Layout */
    .env-grid {
      grid-template-columns: 1fr 1fr 1fr;
      align-items: stretch;
    }
    
    @media (max-width: 768px) {
      .env-grid {
        grid-template-columns: 1fr;
      }
      
      .env-grid > div {
        height: auto !important;
      }
    }
    
    @media (prefers-color-scheme: dark) {
      .table-header {
        background: rgba(30, 41, 59, 0.6);
      }
      
      .table-container::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.5);
      }
      
      .table-container::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.4);
      }
      
      .table-container::-webkit-scrollbar-thumb:hover {
        background: rgba(102, 126, 234, 0.6);
      }
    }
    
    .alert-box {
      border-radius: 16px;
      padding: 16px;
      border-left: 4px solid;
    }
    
    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border-color: #10b981;
    }
    
    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border-color: #f59e0b;
    }
    
    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border-color: #ef4444;
    }
    
    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #1a1f2e 0%, #0f1419 100%);
      }
      
      .neumorphism-card {
        background: #1e293b;
        box-shadow: 
          8px 8px 16px rgba(0, 0, 0, 0.5),
          -8px -8px 16px rgba(51, 65, 85, 0.3);
      }
      
      .neumorphism-inset {
        background: #0f172a;
        box-shadow: 
          inset 4px 4px 8px rgba(0, 0, 0, 0.4),
          inset -4px -4px 8px rgba(51, 65, 85, 0.2);
      }
      
      .alert-success {
        background: rgba(16, 185, 129, 0.15);
      }
      
      .alert-warning {
        background: rgba(245, 158, 11, 0.15);
      }
      
      .alert-error {
        background: rgba(239, 68, 68, 0.15);
      }
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="h-full min-h-screen">
  <div class="max-w-[95%] xl:max-w-[98%] mx-auto px-4 md:px-6 lg:px-8 py-6 md:py-8 lg:py-10">
    {% set pass_count = details.checks | selectattr('status','equalto','PASS') | list | length %}
    {% set warn_count = details.checks | selectattr('status','equalto','WARN') | list | length %}
    {% set fail_count = details.checks | selectattr('status','equalto','FAIL') | list | length %}
    {% set total_count = details.checks | length %}

    <!-- Header -->
    <header class="mb-10">
      <div class="neumorphism-card p-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
          <div class="flex items-center gap-6">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
              <span class="text-2xl font-bold text-white">{{ product[0] | upper }}</span>
            </div>
            <div class="space-y-2">
              <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                {{ product | upper }} {{ version }}
              </h1>
              <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Hardware Compatibility Report</p>
              <div class="flex flex-wrap items-center gap-3 text-xs text-gray-500 dark:text-gray-400">
                <span>üïê <span id="gen-time"></span></span>
                <span>‚Ä¢</span>
                <span>üíª {{ facts.os.hostname | default('N/A') }}</span>
                <span>‚Ä¢</span>
                <span>üë§ {{ facts.os.user | default('N/A') }}</span>
              </div>
            </div>
          </div>
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
            <div class="flex items-center gap-3">
              {% if overall == 'Ready' %}
                <span class="status-badge status-ready text-base px-4 py-2">‚úÖ Ready</span>
              {% elif overall == 'Needs Upgrade' %}
                <span class="status-badge status-needs-upgrade text-base px-4 py-2">‚ö†Ô∏è Needs Upgrade</span>
              {% else %}
                <span class="status-badge status-not-ready text-base px-4 py-2">‚ùå Not Ready</span>
              {% endif %}
            </div>
            <div class="flex items-center gap-3">
              <button onclick="window.print()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-xl transition-colors text-sm font-semibold shadow-md hover:shadow-lg">
                üìÑ Export PDF
              </button>
              <button id="copy-json" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl transition-colors text-sm font-semibold shadow-md hover:shadow-lg">
                üìã JSON
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Status Alert Banner -->
    {% if overall != 'Ready' %}
    <div class="mb-10">
      {% if overall == 'Not Supported' %}
        <div class="alert-box alert-error">
          <div class="flex items-start gap-4">
            <div class="text-2xl">üö®</div>
            <div class="flex-1">
              <h3 class="font-bold text-red-700 dark:text-red-400 text-base mb-1">System Not Ready</h3>
              <p class="text-sm text-red-600 dark:text-red-300">Your system does not meet the minimum requirements. Please address the critical issues below before installing {{ product | upper }} {{ version }}.</p>
            </div>
          </div>
        </div>
      {% else %}
        <div class="alert-box alert-warning">
          <div class="flex items-start gap-4">
            <div class="text-2xl">‚ö†Ô∏è</div>
            <div class="flex-1">
              <h3 class="font-bold text-amber-700 dark:text-amber-400 text-base mb-1">System Needs Upgrade</h3>
              <p class="text-sm text-amber-600 dark:text-amber-300">Your system meets minimum requirements but improvements are recommended for better performance with {{ product | upper }} {{ version }}.</p>
            </div>
          </div>
        </div>
      {% endif %}
    </div>
    {% endif %}

    <!-- Main Content Grid -->
    {% set label_map = {
      'os.version':'H·ªá ƒëi·ªÅu h√†nh', 'os_version':'H·ªá ƒëi·ªÅu h√†nh', 'os.win64':'H·ªá ƒëi·ªÅu h√†nh', 'os_win64':'H·ªá ƒëi·ªÅu h√†nh',
      'ram_total':'RAM', 'ram.total_gb':'RAM', 'ram_total_gb':'RAM', 'ram.total':'RAM',
      'cpu_threads':'CPU', 'cpu.logical_processors':'CPU', 'cpu_logical_processors':'CPU', 'cpu.cores':'CPU', 'cpu_cores':'CPU',
      'gpu.vram_gb':'GPU', 'gpu_vram_gb':'GPU', 'gpu.vram':'GPU',
      'gpu.directx_feature_level':'DirectX', 'gpu_directx_feature_level':'DirectX', 'directx_feature_level':'DirectX',
      'storage.free_gb':'Dung l∆∞·ª£ng tr·ªëng', 'storage_free_gb':'Dung l∆∞·ª£ng tr·ªëng'
    } %}
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6 lg:gap-8 xl:gap-12 items-stretch mb-10">
      <!-- Checks Cards -->
      <section class="lg:col-span-8 flex flex-col">
        <div class="neumorphism-card p-4 md:p-6 lg:p-8 flex flex-col flex-1">
          <div class="mb-6 xl:mb-8">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Hardware Checks</h2>
            <p class="text-xs md:text-sm text-gray-500 dark:text-gray-400">Detailed compatibility analysis</p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
            {% for c in details.checks %}
            {% if 'storage_type' not in (c.id | string) and 'storage.type' not in (c.id | string) %}
              {% set raw_id = (c.id | string) %}
              {% set norm_id = raw_id.replace('.', '_').replace('-', '_') %}
              {% set obj_name = label_map.get(raw_id) or label_map.get(norm_id) or (c.target if c.target else raw_id) %}
              {% if obj_name == c.target or obj_name == raw_id %}
                {% if 'gpu.vram' in raw_id %}{% set obj_name = 'GPU VRAM' %}
                {% elif 'os' in raw_id %}{% set obj_name = 'H·ªá ƒëi·ªÅu h√†nh' %}
                {% elif 'ram' in raw_id %}{% set obj_name = 'RAM' %}
                {% elif 'cpu' in raw_id %}{% set obj_name = 'CPU' %}
                {% elif 'gpu' in raw_id and 'vram' in raw_id %}{% set obj_name = 'GPU VRAM' %}
                {% elif 'directx' in raw_id %}{% set obj_name = 'DirectX' %}
                {% elif 'storage' in raw_id %}{% set obj_name = 'Dung l∆∞·ª£ng tr·ªëng' %}
                {% endif %}
              {% endif %}
              {% set card_class = 'fail' if c.status=='FAIL' else ('warn' if c.status=='WARN' else 'pass') %}
              <div class="check-card {{ card_class }}">
                <div class="flex items-start justify-between mb-3">
                  <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200">{{ obj_name }}</h4>
                  {% if c.status=='PASS' %}
                    <span class="status-badge status-PASS text-xs">‚úÖ PASS</span>
                  {% elif c.status=='WARN' %}
                    <span class="status-badge status-WARN text-xs">‚ö†Ô∏è WARN</span>
                  {% else %}
                    <span class="status-badge status-FAIL text-xs">‚ùå FAIL</span>
                  {% endif %}
                </div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-400">Current:</span>
                    <span class="font-semibold text-gray-800 dark:text-gray-200">{{ c.actual }}{% if c.unit and c.unit | trim %} {{ c.unit }}{% endif %}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-400">Min:</span>
                    <span class="font-semibold text-gray-800 dark:text-gray-200">{{ c.min }}{% if c.unit and c.unit | trim %} {{ c.unit }}{% endif %}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-400">Recommended:</span>
                    <span class="font-semibold text-gray-800 dark:text-gray-200">{{ c.recommended }}{% if c.unit and c.unit | trim %} {{ c.unit }}{% endif %}</span>
                  </div>
                  <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
                    {% set sev = c.severity | default('') | lower %}
                    <span class="text-xs text-gray-500 dark:text-gray-400">
                      Priority: 
                      {% if sev == 'required' %}
                        <span class="font-semibold text-gray-700 dark:text-gray-300">Required</span>
                      {% elif sev == 'recommended' %}
                        <span class="font-semibold text-blue-600 dark:text-blue-400">Recommended</span>
                      {% else %}
                        <span class="font-semibold text-gray-500 dark:text-gray-400">Optional</span>
                      {% endif %}
                    </span>
                  </div>
                </div>
              </div>
            {% endif %}
            {% endfor %}
          </div>
        </div>
      </section>

      <!-- Summary Sidebar -->
      <aside class="lg:col-span-4 flex flex-col" id="summary-sidebar">
        <div class="neumorphism-card p-4 md:p-5 lg:p-6 space-y-4 flex flex-col flex-1">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-lg md:text-xl font-bold text-gray-800 dark:text-gray-200">Summary</h2>
            <button onclick="toggleSidebar()" class="lg:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
              <span id="sidebar-toggle-icon">‚ò∞</span>
            </button>
          </div>
          <div id="sidebar-content" class="space-y-4 lg:block hidden flex flex-col flex-1">
            <!-- Overall Status - Compact -->
            <div>
              <div class="space-y-3">
                <div>
                  {% if overall=='Ready' %}
                    <div class="alert-box alert-success py-3 px-4">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                          <span class="text-xl">‚úÖ</span>
                          <span class="status-badge status-ready text-sm font-semibold">Ready</span>
                        </div>
                        <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">{{ total_count }} checks</span>
                      </div>
                    </div>
                  {% elif overall=='Needs Upgrade' %}
                    <div class="alert-box alert-warning py-3 px-4">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                          <span class="text-xl">‚ö†Ô∏è</span>
                          <span class="status-badge status-needs-upgrade text-sm font-semibold">Needs Upgrade</span>
                        </div>
                        <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">{{ total_count }} checks</span>
                      </div>
                    </div>
                  {% else %}
                    <div class="alert-box alert-error py-3 px-4">
                      <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                          <span class="text-xl">‚ùå</span>
                          <span class="status-badge status-not-ready text-sm font-semibold">Not Ready</span>
                        </div>
                        <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">{{ total_count }} checks</span>
                      </div>
                    </div>
                  {% endif %}
                  <div class="neumorphism-inset p-3 rounded-lg mt-3">
                    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Check Results</p>
                    <div class="flex items-center justify-between text-sm">
                      <span class="flex items-center gap-2">
                        <span class="text-green-600 dark:text-green-400 text-lg">‚úÖ</span>
                        <span class="text-gray-700 dark:text-gray-300 font-semibold">{{ pass_count }} Pass</span>
                      </span>
                      <span class="flex items-center gap-2">
                        <span class="text-amber-600 dark:text-amber-400 text-lg">‚ö†Ô∏è</span>
                        <span class="text-gray-700 dark:text-gray-300 font-semibold">{{ warn_count }} Warn</span>
                      </span>
                      <span class="flex items-center gap-2">
                        <span class="text-red-600 dark:text-red-400 text-lg">‚ùå</span>
                        <span class="text-gray-700 dark:text-gray-300 font-semibold">{{ fail_count }} Fail</span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Critical Issues Section -->
            {% set failed_checks = details.checks | selectattr('status','equalto','FAIL') | list %}
            {% if failed_checks %}
            <div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Critical Issues</p>
              <div class="space-y-2">
                {% for c in failed_checks %}
                {% if 'storage_type' not in (c.id | string) and 'storage.type' not in (c.id | string) %}
                  {% set raw_id = (c.id | string) %}
                  {% set norm_id = raw_id.replace('.', '_').replace('-', '_') %}
                  {% set obj_name = label_map.get(raw_id) or label_map.get(norm_id) or (c.target if c.target else raw_id) %}
                  {% if obj_name == c.target or obj_name == raw_id %}
                    {% if 'gpu.vram' in raw_id or 'gpu_vram' in raw_id %}{% set obj_name = 'GPU VRAM' %}
                    {% elif 'os' in raw_id %}{% set obj_name = 'H·ªá ƒëi·ªÅu h√†nh' %}
                    {% elif 'ram' in raw_id %}{% set obj_name = 'RAM' %}
                    {% elif 'cpu' in raw_id %}{% set obj_name = 'CPU' %}
                    {% elif 'directx' in raw_id %}{% set obj_name = 'DirectX' %}
                    {% elif 'storage_free' in raw_id or 'storage.free' in raw_id %}{% set obj_name = 'Dung l∆∞·ª£ng ·ªï c·ª©ng tr·ªëng' %}
                    {% endif %}
                  {% endif %}
                  <div class="bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 p-3 rounded-xl border-l-4 border-yellow-500">
                    <div class="flex items-start gap-2">
                      <span class="text-lg">‚ö†Ô∏è</span>
                      <div class="flex-1 min-w-0">
                        <p class="font-bold text-yellow-800 dark:text-yellow-300 text-xs mb-1">{{ obj_name }}</p>
                        <p class="text-xs text-yellow-700 dark:text-yellow-400">Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }}</span> | Required: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                      </div>
                    </div>
                  </div>
                {% endif %}
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <!-- Analysis Section -->
            <div class="flex-1 flex flex-col min-h-0">
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Analysis</p>
              <div class="text-xs text-gray-600 dark:text-gray-400 space-y-2 max-h-80 overflow-y-auto analysis-scroll flex-1">
              {% if overall=='Ready' %}
                <div class="alert-box alert-success py-2 px-3">
                  <p class="leading-relaxed text-xs">üéâ Your system meets all requirements for {{ product | upper }} {{ version }}. You're all set!</p>
                </div>
              {% else %}
                {% set warned_checks = details.checks | selectattr('status','equalto','WARN') | list %}
                {% if warned_checks %}
                  <div class="space-y-2">
                    {% for c in warned_checks %}
                    {% if 'storage_type' not in (c.id | string) and 'storage.type' not in (c.id | string) %}
                      {% set raw_id = (c.id | string) %}
                      {% set norm_id = raw_id.replace('.', '_').replace('-', '_') %}
                      {% set obj_name = label_map.get(raw_id) or label_map.get(norm_id) or (c.target if c.target else raw_id) %}
                      {% if obj_name == c.target or obj_name == raw_id %}
                        {% if 'gpu.vram' in raw_id or 'gpu_vram' in raw_id %}{% set obj_name = 'GPU VRAM' %}
                        {% elif 'os' in raw_id %}{% set obj_name = 'H·ªá ƒëi·ªÅu h√†nh' %}
                        {% elif 'ram' in raw_id %}{% set obj_name = 'RAM' %}
                        {% elif 'cpu' in raw_id %}{% set obj_name = 'CPU' %}
                        {% elif 'directx' in raw_id %}{% set obj_name = 'DirectX' %}
                        {% elif 'storage_free' in raw_id or 'storage.free' in raw_id %}{% set obj_name = 'Dung l∆∞·ª£ng ·ªï c·ª©ng tr·ªëng' %}
                        {% endif %}
                      {% endif %}
                      <div class="neumorphism-inset p-2.5 rounded-lg border-l-4 border-amber-500">
                        <div class="flex items-start gap-1.5 mb-1.5">
                          <span class="text-sm">‚ö†Ô∏è</span>
                          <span class="font-bold text-gray-800 dark:text-gray-200 text-xs">{{ obj_name }}</span>
                        </div>
                        <div class="text-xs space-y-0.5 ml-5">
                          {% if 'os' in raw_id or 'os_version' in raw_id or 'os_win64' in raw_id %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}</span></p>
                            <p>Min: <span class="font-semibold">{{ c.min }}</span></p>
                            {% if c.recommended %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Upgrade to <span class="font-semibold">{{ c.recommended }}</span></p>
                            {% endif %}
                          {% elif 'ram' in raw_id %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }}</span></p>
                            <p>Min: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                            {% if c.recommended %}
                              {% set diff = c.recommended - c.actual %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Upgrade to <span class="font-semibold">{{ c.recommended }}{{ c.unit }}</span> (need {{ diff }}{{ c.unit }})</p>
                            {% endif %}
                          {% elif 'cpu' in raw_id %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }}</span></p>
                            <p>Min: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                            {% if c.recommended %}
                              {% set diff = c.recommended - c.actual %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Upgrade to <span class="font-semibold">{{ c.recommended }}{{ c.unit }}</span> (need {{ diff }}{{ c.unit }})</p>
                            {% endif %}
                          {% elif 'gpu_vram' in raw_id or 'gpu.vram' in raw_id %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }}</span></p>
                            <p>Min: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                            {% if c.recommended %}
                              {% set diff = c.recommended - c.actual %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Upgrade GPU to <span class="font-semibold">{{ c.recommended }}{{ c.unit }} VRAM</span> (need {{ diff }}{{ c.unit }})</p>
                            {% endif %}
                          {% elif 'directx' in raw_id %}
                            <p>Current: <span class="font-semibold">DirectX {{ c.actual }}</span></p>
                            <p>Min: <span class="font-semibold">DirectX {{ c.min }}</span></p>
                            {% if c.recommended and c.recommended != c.actual %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Update GPU driver for <span class="font-semibold">DirectX {{ c.recommended }}</span></p>
                            {% endif %}
                          {% elif 'storage_free' in raw_id or 'storage.free' in raw_id %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }} free</span></p>
                            <p>Min: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                            {% if c.recommended %}
                              {% set diff = c.recommended - c.actual %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Free up <span class="font-semibold">{{ diff }}{{ c.unit }} more</span> (total {{ c.recommended }}{{ c.unit }})</p>
                            {% endif %}
                          {% else %}
                            <p>Current: <span class="font-semibold">{{ c.actual }}{{ c.unit }}</span></p>
                            <p>Required: <span class="font-semibold">{{ c.min }}{{ c.unit }}</span></p>
                            {% if c.recommended %}
                              <p class="text-amber-600 dark:text-amber-400">‚Üí Recommended: <span class="font-semibold">{{ c.recommended }}{{ c.unit }}</span></p>
                            {% endif %}
                          {% endif %}
                        </div>
                      </div>
                    {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}
              {% endif %}
            </div>
          </div>

            <!-- Resources -->
            <div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Resources</p>
              {% set product_links = {
                'autocad': 'https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/System-requirements-for-AutoCAD.html',
                'inventor': 'https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/System-requirements-for-Autodesk-Inventor-Products.html',
                'revit': 'https://www.autodesk.com/support/technical/article/caas/sfdcarticles/sfdcarticles/System-requirements-for-Autodesk-Revit-products.html'
              } %}
              {% set product_link = product_links.get(product | lower, 'https://www.autodesk.com/support/technical/requirements') %}
              <a href="{{ product_link }}" target="_blank" class="inline-flex items-center gap-1.5 text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 font-medium hover:underline transition-colors neumorphism-inset p-2 rounded-lg">
                <span>üìö</span>
                <span class="truncate">System Requirements</span>
              </a>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Environment Section -->
    <section class="mb-10">
      <div class="neumorphism-card p-8" style="background: rgba(245, 247, 250, 0.6);">
        <div class="flex items-center justify-between mb-8">
          <div>
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">System Environment</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">Detailed hardware specifications</p>
          </div>
          <button onclick="toggleEnv()" class="neumorphism-inset px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:opacity-80 rounded-xl">
            Toggle Details
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 env-grid">
          <!-- Column 1: Operating System + Processor -->
          <div class="flex flex-col gap-6">
            <div class="neumorphism-inset p-5 rounded-xl flex-1">
              <div class="flex items-start gap-3 mb-2">
                <span class="text-xl">üñ•Ô∏è</span>
                <div class="flex-1">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Operating System</p>
                  <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 break-words">{{ facts.os.name or '' }} {{ facts.os.version or '' }}</p>
                </div>
              </div>
            </div>
            <div class="neumorphism-inset p-5 rounded-xl flex-1">
              <div class="flex items-start gap-3 mb-2">
                <span class="text-xl">üíª</span>
                <div class="flex-1">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Processor</p>
                  <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 break-words">{{ facts.cpu.name or '' }}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ facts.cpu.cores or '' }} cores</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Column 2: Memory + Storage -->
          <div class="flex flex-col gap-6">
            <div class="neumorphism-inset p-5 rounded-xl flex-1">
              <div class="flex items-start gap-3 mb-2">
                <span class="text-xl">üß†</span>
                <div class="flex-1">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Memory</p>
                  <p class="text-sm font-semibold text-gray-800 dark:text-gray-200">{{ facts.ram.total_gb or '' }} GB RAM</p>
                </div>
              </div>
            </div>
            <div class="neumorphism-inset p-5 rounded-xl flex-1">
              <div class="flex items-start gap-3 mb-2">
                <span class="text-xl">üíæ</span>
                <div class="flex-1">
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">Storage</p>
                  <p class="text-sm font-semibold text-gray-800 dark:text-gray-200">{{ facts.storage.free_gb | default('N/A') }} GB free</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Column 3: Graphics (full height) -->
          <div class="neumorphism-inset p-5 rounded-xl h-full">
            <div class="flex items-start gap-3 mb-2">
              <span class="text-xl">üéÆ</span>
              <div class="flex-1">
                <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-3">Graphics</p>
                {% if facts.gpu.adapters %}
                  {% for g in facts.gpu.adapters %}
                    <div class="mb-3 pb-3 {% if not loop.last %}border-b border-gray-200 dark:border-gray-700{% endif %}">
                      <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 break-words mb-1">{{ g.name }}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">{{ (g.vram_gb ~ ' GB VRAM') if g.vram_gb else 'VRAM: N/A' }}</p>
                    </div>
                  {% endfor %}
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 break-words">Primary: {{ facts.gpu.name | default('N/A') }} (DX {{ facts.gpu.directx_feature_level | default('N/A') }})</p>
                {% else %}
                  <p class="text-sm font-semibold text-gray-800 dark:text-gray-200 break-words mb-1">{{ facts.gpu.name | default('N/A') }}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400 break-words">{{ facts.gpu.vram_gb | default('N/A') }}GB VRAM, DirectX {{ facts.gpu.directx_feature_level | default('N/A') }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="mt-8">
          <details class="neumorphism-inset p-4 rounded-xl">
            <summary class="cursor-pointer text-sm font-semibold text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">
              View Raw JSON Data
            </summary>
            <pre id="env" class="text-xs overflow-x-auto whitespace-pre-wrap mt-4 text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">{{ facts | tojson(indent=2) }}</pre>
          </details>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="text-center">
      <div class="neumorphism-inset p-5 rounded-xl">
        <p class="text-xs text-gray-500 dark:text-gray-400">
          Generated by <span class="font-semibold">Autodesk Hardware Scanner v1.2</span> ‚Ä¢ 
          ¬© OneCAD Vietnam 2025 ‚Ä¢ 
          <span class="text-indigo-600 dark:text-indigo-400">Data processed locally, not sent externally</span>
        </p>
      </div>
    </footer>
  </div>

  <script>
    function toggleEnv(){
      const el = document.getElementById('env');
      if(!el) return; 
      el.style.display = (el.style.display === 'none') ? 'block' : 'none';
    }
    
    function toggleSidebar(){
      const sidebar = document.getElementById('sidebar-content');
      const icon = document.getElementById('sidebar-toggle-icon');
      if(!sidebar || !icon) return;
      if(sidebar.classList.contains('hidden')){
        sidebar.classList.remove('hidden');
        sidebar.classList.add('block');
        icon.textContent = '‚úï';
      } else {
        sidebar.classList.remove('block');
        sidebar.classList.add('hidden');
        icon.textContent = '‚ò∞';
      }
    }
    
    // Set generated time
    (function(){
      try{
        const el = document.getElementById('gen-time');
        if(el){ 
          el.textContent = new Date().toLocaleString('vi-VN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          }); 
        }
      }catch(e){}
    })();
    
    // Copy JSON
    document.getElementById('copy-json')?.addEventListener('click', async () => {
      try{
        const raw = document.getElementById('env')?.textContent || '';
        await navigator.clipboard.writeText(raw);
        const btn = document.getElementById('copy-json');
        const originalText = btn.textContent;
        btn.textContent = '‚úì Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }catch(e){ 
        alert('Could not copy JSON'); 
      }
    });
  </script>
</body>
</html>
