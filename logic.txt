# Autodesk Hardware Scanner - Logic hoạt động

---
# LOG cập nhật dự án
- 2025-11-05: Hoàn tất build EXE thành công bằng Python 3.11 + PyInstaller 6.16.0 (onefile)
- 2025-11-05: Thêm script build cho Windows
  - build.bat: tự tìm python (PATH, %LOCALAPPDATA%, C:\Python3xx, Program Files) và gọi PyInstaller qua spec
  - build.ps1: bản PowerShell tương tự, xử lý thiếu PATH, tự cài PyInstaller nếu cần
- 2025-11-05: Cập nhật build.spec
  - datas: đóng gói `scanner/rules`, `report/templates`, `dxinfo.xml`
  - hiddenimports: `webview`, `webview.platforms.winforms`, `webview.platforms.cef`, `pythoncom`, `pywintypes`
- 2025-11-05: Khắc phục lỗi hook pywin32 khi build (pythoncom/_win32sysloader)
  - Cài/đồng bộ `pywin32` và chạy `python -m pywin32_postinstall install` trong venv
- 2025-11-05: Bổ sung tài liệu
  - BUILD_GUIDE.md: hướng dẫn build chi tiết, xử lý lỗi thường gặp
  - INSTALL.md: hướng dẫn chạy EXE cho người dùng cuối
- 2025-11-05: Sửa `scanner/main.py` xoá duplicate `popup_report`, chuẩn hoá đường dẫn template khi chạy trong PyInstaller
- 2025-11-05: Thêm `pywebview==5.3.0` vào requirements (popup báo cáo)
- 2025-11-05: Nhấn mạnh dùng Python 3.10/3.11 (khuyến nghị 3.11) thay vì 3.13 để build ổn định
- 2025-10-30: Thêm collector fallback VRAM GPU (chọn card VRAM lớn nhất từ dxdiag/WMI, giữ directx feature level từ dxdiag nếu có)
- 2025-10-30: Sửa logic so sánh phiên bản Windows trong rules_engine cho đúng thứ tự thực tế (extract major version)
- 2025-10-30: Bổ sung các rule JSON cho autocad_2026, revit_2026, inventor_2026 mẫu
- 2025-10-30: Tích hợp pywebview, thêm hàm popup_report vào main.py để mở giao diện HTML báo cáo đẹp như trình duyệt, không cần browser ngoài
- 2025-10-30: Thêm nút Export PDF (window.print()) vào report.html.j2 ở Header, sử dụng Tailwind cho style đẹp
- 2025-10-30: Hướng dẫn quy trình kiểm thử GUI popup trong Python shell (test webview)

# (Các thay đổi khác vẫn được cập nhật ở phần mô tả logic bên dưới...)

1. **Khởi chạy**
   - Người dùng chạy CLI hoặc EXE kèm tham số (product + version), ví dụ:
     python -m scanner.main --product revit --version 2025 --out out

2. **Thu thập thông tin phần cứng (collectors)**
   - Gọi lần lượt các collector:
     - OS: Lấy tên/windows version
     - CPU: Thông tin chip, số core logic, xung nhịp
     - RAM: Tổng RAM thực tế
     - GPU: Card đồ họa, VRAM lớn nhất, DirectX feature level
     - STORAGE: Tổng dung lượng trống, loại ổ chính
     - (tùy chọn: network, ping...)
   - Kết quả được gom thành dict facts chuẩn hóa.

3. **Đọc rule JSON**
   - Nạp file rule theo tham số sản phẩm (rules/autocad_2025.json, ...)
   - Mỗi rule chứa danh sách các "checks" - mỗi check chỉ định:
     - Trường cần kiểm tra (target, vd: ram.total_gb)
     - Toán tử (>=num, in, >=str...)
     - Ngưỡng min, recommended, đơn vị, mức độ nghiêm trọng

4. **So khớp quy tắc (rules_engine.py)**
   - Lấy giá trị tương ứng từ kết quả thực tế (facts)
   - So sánh giá trị thực với min theo toán tử chỉ định
   - Đánh giá từng check: PASS / FAIL / WARN
   - Tổng hợp kết luận overall: Ready / Needs Upgrade / Not Supported
     - Not Supported nếu bất kỳ required nào FAIL
     - Needs Upgrade nếu có WARN ở recommended, không có required FAIL
     - Ready nếu mọi yêu cầu đều PASS

5. **Sinh báo cáo kết quả**
   - Lưu kết quả chi tiết ra JSON gồm: kết quả từng check, facts phần cứng, overall
   - (Nếu bật) Sinh file HTML dùng template Tailwind đẹp mắt, tổng quan + từng check + raw facts

6. **Đóng gói, mở rộng**
   - Có thể build EXE với PyInstaller (thêm --add-data)
   - Có thể thay/đổi rule bằng sửa file JSON không cần build lại EXE
   - Dễ mở rộng thêm collector, bổ sung rule cho các tiêu chí mới

   Hướng dẫn build nhanh (Windows, khuyến nghị Python 3.11 + venv):
   - Tạo/kích hoạt venv trong thư mục `autodesk-hwscanner`:
     - `python -m venv .venv`  → `./.venv/Scripts/Activate.ps1`
     - `pip install -U pip && pip install -r requirements.txt && pip install pyinstaller`
   - Build:
     - Cách 1: `python -m PyInstaller build.spec --clean`
     - Cách 2: chạy `build.ps1` hoặc `build.bat`
   - Kết quả: `dist/AutodeskHWScanner.exe`

   Lỗi thường gặp khi build và cách xử lý nhanh:
   - Không tìm thấy PyInstaller: cài trong đúng interpreter/venv đang dùng
   - Lỗi pythoncom/_win32sysloader (pywin32): `pip install --upgrade pywin32` rồi `python -m pywin32_postinstall install`
   - Chạy build từ `C:\Windows\System32`: cd về thư mục dự án trước khi build

   Chạy EXE (CLI):
   - `AutodeskHWScanner.exe --product revit --version 2025 --out out`
   - Ứng dụng là CLI, không hiện màn hình chọn; popup webview sẽ mở sau khi sinh báo cáo HTML

# Điểm mạnh
- Dễ mở rộng rule, collector
- Báo cáo thân thiện, dễ kiểm tra
- Có thể chạy mọi máy, không cần cài đặt phức tạp

# Ứng dụng
- Kiểm tra máy trước khi cài/làm việc với phần mềm Autodesk (Revit/AutoCAD/Inventor...)
- Dùng cho IT, tự động kiểm tra phòng máy, phát hiện phần cứng chưa đạt yêu cầu nhanh gọn
